(this["webpackJsonpemoji-cam"]=this["webpackJsonpemoji-cam"]||[]).push([[0],{277:function(e,t,n){},278:function(e,t,n){},284:function(e,t){},285:function(e,t){},293:function(e,t){},303:function(e,t,n){"use strict";n.r(t);var i=n(10),o=n.n(i),r=n(99),c=n.n(r),a=(n(277),n(278),n(318)),s=n(9),l=n.n(s),u=n(121),d=n(13),f=n(6),v=n(48),j=n(165);n(108);function b(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"context",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"provider",o=Object(i.useContext)(e);return Object(i.useMemo)((function(){if(void 0===o)throw new Error("Attempting to use ".concat(t," outside of ").concat(n));return o}),[o,t,n])}var h=n(20),O=Object(i.createContext)(void 0),m={nose:0,left_eye:1,right_eye:2,left_ear:3,right_ear:4,left_shoulder:5,right_shoulder:6,left_elbow:7,right_elbow:8,left_wrist:9,right_wrist:10,left_hip:11,right_hip:12,left_knee:13,right_knee:14,left_ankle:15,right_ankle:16},g=function(e){var t=e.children,n=Object(i.useState)(),o=Object(f.a)(n,2),r=o[0],c=o[1];return Object(h.jsx)(O.Provider,{value:Object(i.useMemo)((function(){return{poses:r,setPoses:c}}),[r,c]),children:t})};function p(){return b(O,"PoseContext","PoseContextProvider")}var x=Object(i.createContext)(void 0),w=function(e){var t=e.children,n=Object(i.useState)(),o=Object(f.a)(n,2),r=o[0],c=o[1];return Object(h.jsx)(x.Provider,{value:Object(i.useMemo)((function(){return{message:r,setMessage:c}}),[r,c]),children:t})};function y(){var e=b(x,"ErrorMessageToUserContext");return[e.message,e.setMessage]}var k=Object(i.createContext)(void 0),S=function(e){var t=e.children,n=Object(i.useState)(),o=Object(f.a)(n,2),r=o[0],c=o[1];return Object(h.jsx)(k.Provider,{value:Object(i.useMemo)((function(){return{cameraId:r,setCameraId:c}}),[r,c]),children:t})};function C(){var e=b(k,"CameraSelectionContext");return[e.cameraId,e.setCameraId]}var I=Object(i.createContext)(void 0),P=function(e){var t=e.children,n=Object(i.useState)(),o=Object(f.a)(n,2),r=o[0],c=o[1],a=y()[1],s=C(),l=Object(f.a)(s,1)[0];return Object(i.useEffect)((function(){c((function(e){null===e||void 0===e||e.getVideoTracks().forEach((function(e){return e.stop()}))})),navigator.mediaDevices.getUserMedia({audio:!1,video:{deviceId:{exact:l}}}).then((function(e){c(e)})).catch((function(e){a("Unable to obtain camera stream. Error: ".concat(e.message))}))}),[a,l]),Object(h.jsx)(I.Provider,{value:Object(i.useMemo)((function(){return{videoSrcObject:r}}),[r]),children:t})};function M(){return b(I,"UserVideoStreamContext","UserVideoStreamProvider").videoSrcObject}var _=n(321),N=n(256),E=n.n(N);var W=Object(a.a)((function(e){return{root:{backgroundColor:"#ee886b",padding:16,height:60,borderRadius:30,boxSizing:"border-box",display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"},icon:{width:32,height:32}}})),T=function(e){var t=e.className,n=W(),o=function(){var e=Object(i.useState)(),t=Object(f.a)(e,2),n=t[0],o=t[1];return Object(i.useEffect)((function(){navigator.mediaDevices.enumerateDevices().then((function(e){var t=e.filter((function(e){return"videoinput"===e.kind}));o(t)}))}),[]),n}(),r=C(),c=Object(f.a)(r,2),a=c[0],s=c[1],l=M(),u=Object(i.useMemo)((function(){var e;return void 0!==a?a:null===l||void 0===l||null===(e=l.getVideoTracks()[0])||void 0===e?void 0:e.getSettings().deviceId}),[a,l]),d=Object(i.useMemo)((function(){if(void 0!==u)return null===o||void 0===o?void 0:o.findIndex((function(e){return e.deviceId===u}))}),[u,o]),j=Object(i.useMemo)((function(){if(void 0!==o)return void 0!==d?(d+1)%o.length:0}),[o,d]),b=Object(i.useMemo)((function(){if(void 0!==o&&void 0!==j)return o[j]}),[o,j]),O=Object(i.useCallback)((function(){void 0!==b&&s(b.deviceId)}),[b,s]);return void 0===b||void 0===o||o.length<=1?null:Object(h.jsx)(_.a,{className:Object(v.a)(n.root,t),onClick:O,children:Object(h.jsx)(E.a,{className:n.icon})})},F=Object(a.a)((function(e){return{root:{transition:"opacity 0.5s"},fadedOut:{opacity:0},fadedIn:{opacity:1},video:{width:"100%",height:"100%",objectFit:"cover",objectPosition:"center center"},cameraSelector:{zIndex:10,position:"absolute",bottom:40,left:"calc(50% - 70px)",width:140}}})),L=function(e){var t=e.className,n=Object(i.useState)(null),o=Object(f.a)(n,2),r=o[0],c=o[1],a=Object(i.useState)(),s=Object(f.a)(a,2),b=s[0],O=s[1],m=M();Object(i.useEffect)((function(){var e={modelType:j.c.modelType.SINGLEPOSE_LIGHTNING};j.b(j.a.MoveNet,e).then((function(e){return O(e)}))}),[]);var g=Object(i.useState)(!1),x=Object(f.a)(g,2),w=x[0],y=x[1],k=Object(i.useState)(!1),S=Object(f.a)(k,2),C=S[0],I=S[1],P=p().setPoses,_=Object(i.useCallback)(function(){var e=Object(d.a)(l.a.mark((function e(t,n){var i,o,r,c,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.estimatePoses(t);case 2:i=e.sent,o=U(t),r=o.scaleFactor,c=o.xOffset,a=o.yOffset,s=i.map((function(e){return Object(u.a)(Object(u.a)({},e),{},{keypoints:e.keypoints.map((function(e){return Object(u.a)(Object(u.a)({},e),{},{x:e.x*r+c,y:e.y*r+a})}))})})),P(s),I(!0);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[P]);Object(i.useEffect)((function(){if(null!==r&&void 0!==m&&void 0!==b&&(console.log("videoEl nonnull, srcOgbject nonnull and detector nonnull"),r.srcObject=m,w)){console.log("video loaded data");var e=setInterval((function(){return _(r,b)}),100);return function(){clearInterval(e),y(!1),P(void 0)}}}),[r,m,b,w,P,_]);var N=F();return Object(h.jsxs)("div",{className:Object(v.a)(N.root,t,m&&w&&C?N.fadedIn:N.fadedOut),children:[Object(h.jsx)("video",{className:N.video,playsInline:!0,autoPlay:!0,onLoadedData:Object(i.useCallback)((function(){return y(!0)}),[]),ref:c}),Object(h.jsx)(T,{className:N.cameraSelector})]})};function U(e){var t=Math.max(e.clientWidth/e.videoWidth,e.clientHeight/e.videoHeight);return{scaleFactor:t,xOffset:Math.min(0,(e.clientWidth-t*e.videoWidth)/2),yOffset:Math.min(0,(e.clientHeight-t*e.videoHeight)/2)}}var z=Object(a.a)((function(e){return{root:{width:88,height:88,zIndex:1,position:"absolute",borderWidth:0,textAlign:"center",fontSize:62,lineHeight:"".concat(88,"px"),userSelect:"none",cursor:"default"}}})),A=function(e){var t=e.bodyPart,n=e.emoji,o=e.scoreThreshold,r=z(),c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=p().poses;return Object(i.useMemo)((function(){var i=m[e];return null===n||void 0===n?void 0:n.map((function(e){return e.keypoints[i]})).filter((function(e){var n=e.score;return void 0!==n&&n>t}))}),[n,e,t])}(t,o);return Object(h.jsx)(h.Fragment,{children:null===c||void 0===c?void 0:c.map((function(e,t){return Object(h.jsx)("div",{className:r.root,style:{top:e.y-44,left:e.x-44},children:n},t)}))})},D=Object(a.a)((function(e){return{root:{fontSize:24,marginLeft:24,marginRight:24,textAlign:"center"}}})),H=function(e){var t=e.message,n=D();return void 0!==t?Object(h.jsx)("div",{className:n.root,children:t}):null},$=Object(a.a)((function(e){return{ldsEllipsis:{display:"inline-block",position:"relative",width:80,height:80,"& div":{position:"absolute",top:33,width:13,height:13,borderRadius:"50%",background:"#fff",animationTimingFunction:"cubic-bezier(0, 1, 1, 0)"},"& div:nth-child(1)":{left:8,animation:"$lds-ellipsis1 0.6s infinite"},"& div:nth-child(2)":{left:8,animation:"$lds-ellipsis2 0.6s infinite"},"& div:nth-child(3)":{left:32,animation:"$lds-ellipsis2 0.6s infinite"},"& div:nth-child(4)":{left:56,animation:"$lds-ellipsis3 0.6s infinite"}},"@keyframes lds-ellipsis1":{"0%":{transform:"scale(0)"},"100%":{transform:"scale(1)"}},"@keyframes lds-ellipsis3":{"0%":{transform:"scale(1)"},"100%":{transform:"scale(0)"}},"@keyframes lds-ellipsis2":{"0%":{transform:"translate(0, 0)"},"100%":{transform:"translate(24px, 0)"}}}})),R=function(){var e=$();return Object(h.jsxs)("div",{className:e.ldsEllipsis,children:[Object(h.jsx)("div",{}),Object(h.jsx)("div",{}),Object(h.jsx)("div",{}),Object(h.jsx)("div",{})]})},V=function(){var e=y(),t=Object(f.a)(e,1)[0];return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(H,{message:t}),!t&&Object(h.jsx)(R,{})]})},B=Object(a.a)((function(e){return{video:{position:"absolute",width:"100%",height:"100%",top:0,left:0,right:0}}})),G=function(){var e=B();return Object(h.jsx)(g,{children:Object(h.jsx)(w,{children:Object(h.jsx)(S,{children:Object(h.jsxs)(P,{children:[Object(h.jsx)(V,{}),Object(h.jsx)(L,{className:e.video}),Object(h.jsx)(A,{bodyPart:"left_eye",emoji:"\u2764\ufe0f"}),Object(h.jsx)(A,{bodyPart:"right_eye",emoji:"\u2764\ufe0f"}),Object(h.jsx)(A,{bodyPart:"nose",emoji:"\ud83d\udc3d"})]})})})})},J=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function q(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var K=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,323)).then((function(t){var n=t.getCLS,i=t.getFID,o=t.getFCP,r=t.getLCP,c=t.getTTFB;n(e),i(e),o(e),r(e),c(e)}))};c.a.render(Object(h.jsx)(o.a.StrictMode,{children:Object(h.jsx)(G,{})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/emoji-cam",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/emoji-cam","/service-worker.js");J?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var i=n.headers.get("content-type");404===n.status||null!=i&&-1===i.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):q(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):q(t,e)}))}}(),K()}},[[303,1,2]]]);
//# sourceMappingURL=main.8eb1d39c.chunk.js.map